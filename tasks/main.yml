---
# tasks file for awx
- name: unarchive software
  unarchive:
    src: https://github.com/ansible/awx/archive/{{ awx_version }}.tar.gz
    dest: /tmp
    remote_src: yes
    creates: /tmp/awx-{{ awx_version }}
  notify:
    - run awx installer

- name: configure inventory
  template:
    src: inventory.j2
    dest: /tmp/awx-{{ awx_version }}/installer/inventory

- name: install requirements
  pip:
    name: "{{ item }}"
    state: "{{ awx_package_state }}"
  with_items:
    - ansible
    - docker

- name: install requirements on localhost
  pip:
    name: "{{ item }}"
    state: "{{ awx_package_state }}"
  with_items:
    - ansible-tower-cli
  delegate_to: localhost

- name: flush handlers
  meta: flush_handlers

- name: configure organizations
  include: organization.yml
  with_items: "{{ awx_organizations }}"
  loop_control:
    loop_var: organization
  when:
    - awx_organizations is defined
